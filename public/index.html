<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IS Lärkan - Löpargemenskap i Stockholm</title>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS files -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/animations.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">
                <img src="/images/larkan-logo.png" alt="IS Lärkan Logo">
            </a>
            <div class="nav-links">
                <a href="/">Hem</a>
                <a href="/about">Om oss</a>
                <a href="/events">Evenemang</a>
                <a href="/join">Bli medlem</a>
                <a href="/strava-data">Statistik</a>
            </div>
        </div>
    </nav>

    <div class="mobile-menu">
        <div class="mobile-menu-header">
            <img src="/images/larkan-logo.png" alt="IS Lärkan Logo">
            <button class="mobile-menu-close">
                <span class="material-icons">close</span>
            </button>
        </div>
        <nav class="mobile-nav">
            <a href="/">Hem</a>
            <a href="/about">Om oss</a>
            <a href="/events">Evenemang</a>
            <a href="/join">Bli medlem</a>
            <a href="/strava-data" class="nav-highlight">Löparstatistik</a>
        </nav>
    </div>

    <main>
        <section class="hero">
            <div class="hero-background"></div>
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <h1>Löpning för alla<br>i hjärtat av Stockholm</h1>
                <p>Anslut dig till vår gemenskap av passionerade löpare.<br>Tillsammans springer vi mot nya mål.</p>
                <div class="hero-buttons">
                    <a href="/join" class="button primary">Bli medlem</a>
                    <a href="/events" class="button secondary">Se evenemang</a>
                </div>
            </div>
        </section>

        <section class="features">
            <div class="container">
                <div class="feature-grid">
                    <div class="feature-card">
                        <span class="material-icons">event</span>
                        <h3>Veckolöp</h3>
                        <p>Torsdagar 12:00<br>Gemensam löpning för alla nivåer</p>
                    </div>
                    <div class="feature-card">
                        <span class="material-icons">group</span>
                        <h3>Gemenskap</h3>
                        <p>Träna tillsammans<br>Utvecklas tillsammans</p>
                    </div>
                    <div class="feature-card">
                        <span class="material-icons">trending_up</span>
                        <h3>Strava</h3>
                        <p>Följ dina framsteg<br>Delta i utmaningar</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="statistics">
            <div class="container">
                <h2 class="section-title">Vår gemenskap i siffror</h2>
                <p class="section-subtitle">Se vad vi åstadkommit tillsammans</p>
                <div class="stats-container">
                    <div class="stat-card elevation-2">
                        <div class="stat-icon">
                            <span class="material-icons">people</span>
                        </div>
                        <div class="stat-number" id="memberCount">-</div>
                        <h3 class="stat-label">Medlemmar</h3>
                    </div>
                    <div class="stat-card elevation-2">
                        <div class="stat-icon">
                            <span class="material-icons">directions_run</span>
                        </div>
                        <div class="stat-number" id="weeklyDistance">-</div>
                        <h3 class="stat-label">Total distans</h3>
                    </div>
                    <div class="stat-card elevation-2">
                        <div class="stat-icon">
                            <span class="material-icons">event</span>
                        </div>
                        <div class="stat-number" id="monthlyDistance">-</div>
                        <h3 class="stat-label">Events</h3>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="events">
            <div class="container">
                <h2 class="section-title">Kommande evenemang</h2>
                <p class="section-subtitle">Anslut dig till våra inspirerande löparaktiviteter</p>
                <div class="events-container">
                    <div class="event-card elevation-2" id="nextEvent">
                        <div class="event-header">
                            <div class="event-date">
                                <span class="day">Tors</span>
                                <span class="time">12:00</span>
                            </div>
                            <span class="material-icons">event_available</span>
                        </div>
                        <div class="event-details">
                            <h3>Veckolöpning</h3>
                            <p>5km gemensam löpning</p>
                            <ul class="event-info">
                                <li><span class="material-icons">place</span> Karlbergs Slott</li>
                                <li><span class="material-icons">group</span> Alla nivåer</li>
                            </ul>
                        </div>
                        <button class="button primary full-width">Anmäl dig</button>
                    </div>
                    <div class="event-card elevation-2" id="noEvents" style="display: none;">
                        <p>Inga kommande evenemang</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="testimonials">
            <div class="container">
                <h2 class="section-title">Våra medlemmar berättar</h2>
                <p class="section-subtitle">Upptäck varför våra medlemmar älskar att träna med oss</p>
                <div class="testimonials-container">
                    <div class="testimonial-card elevation-2">
                        <div class="testimonial-content">
                            <div class="quote-icon">
                                <span class="material-icons">format_quote</span>
                            </div>
                            <p class="testimonial-text">"Bästa löpargemenskapen i Stockholm!"</p>
                            <div class="testimonial-author">
                                <div class="author-avatar">
                                    <span class="material-icons">account_circle</span>
                                </div>
                                <div class="author-info">
                                    <strong>Erik K.</strong>
                                    <span class="author-title">Medlem sedan 2023</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Add before closing body tag -->
    <script src="/js/main.js"></script>
    <script>
        async function loadNextEvent() {
            try {
                const response = await fetch('/api/strava/club-events');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const event = await response.json();
                console.log('Received event:', event);
                
                const eventCard = document.getElementById('nextEvent');
                const noEvents = document.getElementById('noEvents');
                
                if (event) {
                    const eventDate = new Date(event.start_date);
                    const dayNames = ['Sön', 'Mån', 'Tis', 'Ons', 'Tors', 'Fre', 'Lör'];
                    const monthNames = ['jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'];
                    const day = dayNames[eventDate.getDay()];
                    const date = eventDate.getDate();
                    const month = monthNames[eventDate.getMonth()];
                    const time = eventDate.toLocaleTimeString('sv-SE', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });

                    eventCard.innerHTML = `
                        <div class="event-header">
                            <div class="event-date">
                                <span class="day">${day} ${date} ${month}</span>
                                <span class="time">${time}</span>
                            </div>
                            <span class="material-icons">event_available</span>
                        </div>
                        <div class="event-details">
                            <h3>${event.title}</h3>
                            <p>${event.description || 'Ingen beskrivning tillgänglig'}</p>
                            <ul class="event-info">
                                <li><span class="material-icons">place</span> ${event.address || 'Plats ej angiven'}</li>
                                <li><span class="material-icons">group</span> Alla nivåer</li>
                            </ul>
                        </div>
                        <a href="https://www.strava.com/clubs/${event.club.id}/group_events/${event.id}" 
                           target="_blank" 
                           class="button primary full-width">
                            Anmäl dig
                        </a>
                    `;
                    
                    eventCard.style.display = 'block';
                    noEvents.style.display = 'none';
                } else {
                    eventCard.style.display = 'none';
                    noEvents.style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading next event:', error);
                document.getElementById('nextEvent').style.display = 'none';
                document.getElementById('noEvents').style.display = 'block';
            }
        }

        // Load the next event when the page loads
        loadNextEvent();
    </script>

    <script>
        async function loadStats() {
            try {
                console.log('Starting to load stats...');
                
                // Load club stats
                const statsResponse = await fetch('/api/strava/club-stats');
                const stats = await statsResponse.json();
                console.log('Received stats:', stats);
                
                // Load events
                const eventsResponse = await fetch('/api/strava/all-events');
                const events = await eventsResponse.json();
                console.log('Received events:', events);

                // Update DOM elements
                const memberCount = document.getElementById('memberCount');
                const weeklyDistance = document.getElementById('weeklyDistance');
                const monthlyDistance = document.getElementById('monthlyDistance');

                if (memberCount && stats.memberCount) {
                    memberCount.textContent = stats.memberCount;
                }

                if (weeklyDistance && stats.weeklyDistance) {
                    weeklyDistance.textContent = `${Math.round(stats.weeklyDistance)} km`;
                }

                if (monthlyDistance && events) {
                    monthlyDistance.textContent = events.length;
                }

            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('memberCount').textContent = '0';
                document.getElementById('weeklyDistance').textContent = '0 km';
                document.getElementById('monthlyDistance').textContent = '0';
            }
        }

        // Load stats when page is fully loaded
        window.addEventListener('load', loadStats);
    </script>

    <!-- Add the footer loader -->
    <script>
        fetch('/components/footer.html')
            .then(response => response.text())
            .then(data => {
                document.body.insertAdjacentHTML('beforeend', data);
            });
    </script>
</body>
</html>